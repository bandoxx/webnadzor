{% extends 'v2/base.html.twig' %}

{% block head %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
{% endblock %}

{% block body %}
    <body
            x-data="{
                page: 'dataTables',
                modalOpen: false,
                editingId: null,
                editData: { t1: '', t2: '', rh1: '', rh2: '' },
                loading: false,
                message: '',
                messageType: '',
                'loaded': true,
                'darkMode': true,
                'stickyMenu': false,
                'sidebarToggle': false,
                'scrollTop': false
            }"
            x-init="
          darkMode = JSON.parse(localStorage.getItem('darkMode'));
          $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
            :class="{'dark text-bodydark bg-boxdark-2': darkMode === true}"
    >
    <!-- ===== Preloader Start ===== -->
    {% block preloader %}
        {{ parent() }}
    {% endblock %}
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
        <!-- ===== Sidebar Start ===== -->
        <aside
                :class="sidebarToggle ? 'translate-x-0' : '-translate-x-full'"
                @click.outside="sidebarToggle = false"
                class="absolute left-0 top-0 z-9999 flex h-screen w-72.5 flex-col bg-black duration-300 ease-linear dark:bg-boxdark lg:static lg:translate-x-0"
        >
            <!-- SIDEBAR HEADER -->
            {% block sidebar_header %}
                {{ parent() }}
            {% endblock %}
            <!-- SIDEBAR HEADER -->

            <div class="no-scrollbar flex flex-col duration-300 ease-linear">
                <!-- Sidebar Menu -->
                <nav class="mt-5 px-4 py-4 lg:mt-9 lg:px-6 min-h-screen" x-data="{selected: $persist('Dashboard')}">
                    <!-- Menu Group -->
                    <div>
                        <h3 class="mb-4 ml-4 text-sm font-medium text-bodydark2">FILTER</h3>
                        <div>
                            <ul class="mb-6 flex flex-col gap-1.5">
                                <li>
                                    <div class="flex flex-col ml-4">
                                        <form id="dateFilter" method="GET">
                                            <label class="mb-2 block text-sm font-medium text-bodydark1">Od datuma</label>
                                            <div class="relative mb-3">
                                                <input
                                                    class="form-datepicker w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-2 font-normal outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"
                                                    data-class="flatpickr-right"
                                                    id="dateFrom"
                                                    name="date_from"
                                                    onkeydown="return false"
                                                    placeholder="dd.mm.yyyy"
                                                    value="{{ dateFrom ? dateFrom|date('d.m.Y') : '' }}"
                                                />
                                                <div class="pointer-events-none absolute inset-0 left-auto right-5 flex items-center">
                                                    <svg fill="none" height="18" viewBox="0 0 18 18" width="18" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M15.7504 2.9812H14.2879V2.36245C14.2879 2.02495 14.0066 1.71558 13.641 1.71558C13.2754 1.71558 12.9941 1.99683 12.9941 2.36245V2.9812H4.97852V2.36245C4.97852 2.02495 4.69727 1.71558 4.33164 1.71558C3.96602 1.71558 3.68477 1.99683 3.68477 2.36245V2.9812H2.25039C1.29414 2.9812 0.478516 3.7687 0.478516 4.75308V14.5406C0.478516 15.4968 1.26602 16.3125 2.25039 16.3125H15.7504C16.7066 16.3125 17.5223 15.525 17.5223 14.5406V4.72495C17.5223 3.7687 16.7066 2.9812 15.7504 2.9812ZM1.77227 8.21245H4.16289V10.9968H1.77227V8.21245ZM5.42852 8.21245H8.38164V10.9968H5.42852V8.21245ZM8.38164 12.2625V15.0187H5.42852V12.2625H8.38164ZM9.64727 12.2625H12.6004V15.0187H9.64727V12.2625ZM9.64727 10.9968V8.21245H12.6004V10.9968H9.64727ZM13.8379 8.21245H16.2285V10.9968H13.8379V8.21245ZM2.25039 4.24683H3.71289V4.83745C3.71289 5.17495 3.99414 5.48433 4.35977 5.48433C4.72539 5.48433 5.00664 5.20308 5.00664 4.83745V4.24683H13.0504V4.83745C13.0504 5.17495 13.3316 5.48433 13.6973 5.48433C14.0629 5.48433 14.3441 5.20308 14.3441 4.83745V4.24683H15.7504C16.0316 4.24683 16.2566 4.47183 16.2566 4.75308V6.94683H1.77227V4.75308C1.77227 4.47183 1.96914 4.24683 2.25039 4.24683ZM1.77227 14.5125V12.2343H4.16289V14.9906H2.25039C1.96914 15.0187 1.77227 14.7937 1.77227 14.5125ZM15.7504 15.0187H13.8379V12.2625H16.2285V14.5406C16.2566 14.7937 16.0316 15.0187 15.7504 15.0187Z" fill="#64748B"/>
                                                    </svg>
                                                </div>
                                            </div>

                                            <label class="mb-2 block text-sm font-medium text-bodydark1">Do datuma</label>
                                            <div class="relative mb-3">
                                                <input
                                                    class="form-datepicker w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-2 font-normal outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"
                                                    data-class="flatpickr-right"
                                                    id="dateTo"
                                                    name="date_to"
                                                    onkeydown="return false"
                                                    placeholder="dd.mm.yyyy"
                                                    value="{{ dateTo ? dateTo|date('d.m.Y') : '' }}"
                                                />
                                                <div class="pointer-events-none absolute inset-0 left-auto right-5 flex items-center">
                                                    <svg fill="none" height="18" viewBox="0 0 18 18" width="18" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M15.7504 2.9812H14.2879V2.36245C14.2879 2.02495 14.0066 1.71558 13.641 1.71558C13.2754 1.71558 12.9941 1.99683 12.9941 2.36245V2.9812H4.97852V2.36245C4.97852 2.02495 4.69727 1.71558 4.33164 1.71558C3.96602 1.71558 3.68477 1.99683 3.68477 2.36245V2.9812H2.25039C1.29414 2.9812 0.478516 3.7687 0.478516 4.75308V14.5406C0.478516 15.4968 1.26602 16.3125 2.25039 16.3125H15.7504C16.7066 16.3125 17.5223 15.525 17.5223 14.5406V4.72495C17.5223 3.7687 16.7066 2.9812 15.7504 2.9812ZM1.77227 8.21245H4.16289V10.9968H1.77227V8.21245ZM5.42852 8.21245H8.38164V10.9968H5.42852V8.21245ZM8.38164 12.2625V15.0187H5.42852V12.2625H8.38164ZM9.64727 12.2625H12.6004V15.0187H9.64727V12.2625ZM9.64727 10.9968V8.21245H12.6004V10.9968H9.64727ZM13.8379 8.21245H16.2285V10.9968H13.8379V8.21245ZM2.25039 4.24683H3.71289V4.83745C3.71289 5.17495 3.99414 5.48433 4.35977 5.48433C4.72539 5.48433 5.00664 5.20308 5.00664 4.83745V4.24683H13.0504V4.83745C13.0504 5.17495 13.3316 5.48433 13.6973 5.48433C14.0629 5.48433 14.3441 5.20308 14.3441 4.83745V4.24683H15.7504C16.0316 4.24683 16.2566 4.47183 16.2566 4.75308V6.94683H1.77227V4.75308C1.77227 4.47183 1.96914 4.24683 2.25039 4.24683ZM1.77227 14.5125V12.2343H4.16289V14.9906H2.25039C1.96914 15.0187 1.77227 14.7937 1.77227 14.5125ZM15.7504 15.0187H13.8379V12.2625H16.2285V14.5406C16.2566 14.7937 16.0316 15.0187 15.7504 15.0187Z" fill="#64748B"/>
                                                    </svg>
                                                </div>
                                            </div>

                                            <button type="submit" class="w-full rounded bg-primary py-2 px-4 font-medium text-white hover:bg-opacity-90">
                                                Filtriraj
                                            </button>
                                        </form>
                                        <hr class="border-t border-gray-300 mt-4 mb-2">
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <h3 class="mb-4 ml-4 text-sm font-medium text-bodydark2">MENU</h3>
                        <div>
                            <ul class="mb-6 flex flex-col gap-1.5">
                                <li class="cursor-pointer">
                                    <a
                                            href="{{ path('app_devicedataarchive_getdailydata', { clientId: client.id, deviceId: device.id, entry: entry }) }}"
                                            class="group relative flex items-center gap-2.5 rounded-sm px-4 py-2 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-graydark dark:hover:bg-meta-4"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
                                        </svg>
                                        Arhiva
                                    </a>
                                </li>
                                <li class="cursor-pointer">
                                    <a
                                            href="{{ path('app_device_export', {clientId: client.id, id: device.id, entry: entry }) }}"
                                            class="group relative flex items-center gap-2.5 rounded-sm px-4 py-2 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-graydark dark:hover:bg-meta-4"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 7.5h-.75A2.25 2.25 0 0 0 4.5 9.75v7.5a2.25 2.25 0 0 0 2.25 2.25h7.5a2.25 2.25 0 0 0 2.25-2.25v-7.5a2.25 2.25 0 0 0-2.25-2.25h-.75m-6 3.75 3 3m0 0 3-3m-3 3V1.5m6 9h.75a2.25 2.25 0 0 1 2.25 2.25v7.5a2.25 2.25 0 0 1-2.25 2.25h-7.5a2.25 2.25 0 0 1-2.25-2.25v-.75" />
                                        </svg>
                                        Izvoz podataka
                                    </a>
                                </li>
                                <li class="cursor-pointer">
                                    <a
                                            href="{{ path('app_device_entry_show', { clientId: client.id, id: device.id, entry: entry }) }}"
                                            class="group relative flex items-center gap-2.5 rounded-sm px-4 py-2 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-graydark dark:hover:bg-meta-4"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
                                        </svg>
                                        Povratak
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </aside>
        <!-- ===== Sidebar End ===== -->

        <!-- ===== Content Area Start ===== -->
        <div class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden">
            <!-- ===== Header Start ===== -->
            {% block header %}
                {{ parent() }}
            {% endblock %}
            <!-- ===== Header End ===== -->

            <!-- ===== Main Content Start ===== -->
            <main>
                <div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">
                    <!-- Breadcrumb Start -->
                    <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                        <h2 class="text-title-md2 font-bold text-black dark:text-white">
                            Izmjena podataka
                        </h2>

                        <nav>
                            <ol class="flex items-center gap-2">
                                <li>
                                    <a class="font-medium" href="{{ path('admin_overview') }}">Dashboard /</a>
                                </li>
                                <li>
                                    <a class="font-medium" href="{{ path('client_overview', { clientId: client.id }) }}">{{ client.name }} /</a>
                                </li>
                                <li class="font-medium">
                                    <a class="font-medium" href="{{ path('app_device_entry_show', { clientId: client.id, id: device.id, entry: entry }) }}">{{ device.name }} /</a>
                                </li>
                                <li class="font-medium text-primary">Izmjena podataka</li>
                            </ol>
                        </nav>
                    </div>
                    <!-- Breadcrumb End -->

                    <!-- Message Alert -->
                    <div x-show="message" x-transition class="mb-4">
                        <div :class="messageType === 'success'
                            ? 'border-[#34D399] bg-[#34D399] bg-opacity-[15%]'
                            : 'border-[#F87171] bg-[#F87171] bg-opacity-[15%]'"
                             class="w-full border-l-6 px-4 py-4 shadow-md rounded-r-lg">
                            <p :class="messageType === 'success' ? 'text-[#219653]' : 'text-[#B45454]'"
                               class="font-medium" x-text="message"></p>
                        </div>
                    </div>

                    <div class="flex flex-col gap-5 md:gap-7 2xl:gap-10">
                        <!-- Data Table Start -->
                        <div class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">
                            <div class="px-4 py-6 md:px-6 xl:px-7.5 border-b border-stroke dark:border-strokedark">
                                <h4 class="text-xl font-bold text-black dark:text-white">
                                    {{ device.name }}
                                </h4>
                                <p class="text-sm text-body dark:text-bodydark mt-1">
                                    Ukupno {{ totalRecords }} zapisa
                                    {% if dateFrom or dateTo %}
                                        (filtrirano: {{ dateFrom ? dateFrom|date('d.m.Y') : '...' }} - {{ dateTo ? dateTo|date('d.m.Y') : '...' }})
                                    {% endif %}
                                </p>
                            </div>
                            <div class="max-w-full overflow-x-auto">
                                <table class="w-full table-auto">
                                    <thead>
                                    <tr class="bg-gray-2 dark:bg-meta-4">
                                        <th class="min-w-[160px] py-4 px-4 text-left font-medium text-black dark:text-white" rowspan="2">
                                            Datum
                                        </th>
                                        <th class="py-4 px-4 text-center font-medium text-black dark:text-white border-b border-stroke dark:border-strokedark" colspan="2">
                                            {{ device.entry1['t_name'] ?? 'Senzor 1' }}
                                        </th>
                                        <th class="py-4 px-4 text-center font-medium text-black dark:text-white border-b border-stroke dark:border-strokedark bg-success bg-opacity-10" colspan="2">
                                            {{ device.entry2['t_name'] ?? 'Senzor 2' }}
                                        </th>
                                        <th class="py-4 px-4 text-center font-medium text-black dark:text-white" rowspan="2">
                                            Akcije
                                        </th>
                                    </tr>
                                    <tr class="bg-gray-2 dark:bg-meta-4">
                                        <th class="py-3 px-4 text-center font-medium text-black dark:text-white">
                                            T1 (°C)
                                        </th>
                                        <th class="py-3 px-4 text-center font-medium text-black dark:text-white">
                                            RH1 (%)
                                        </th>
                                        <th class="py-3 px-4 text-center font-medium text-black dark:text-white bg-success bg-opacity-5">
                                            T2 (°C)
                                        </th>
                                        <th class="py-3 px-4 text-center font-medium text-black dark:text-white bg-success bg-opacity-5">
                                            RH2 (%)
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for data in deviceData %}
                                        <tr class="{{ loop.index is odd ? 'bg-white dark:bg-boxdark' : 'bg-gray-1 dark:bg-meta-4 dark:bg-opacity-50' }} hover:bg-gray-2 dark:hover:bg-meta-4" id="row-{{ data.id }}">
                                            <td class="border-b border-stroke py-4 px-4 dark:border-strokedark">
                                                <p class="text-black dark:text-white font-medium">{{ data.deviceDate|date('d.m.Y') }}</p>
                                                <p class="text-sm text-body dark:text-bodydark">{{ data.deviceDate|date('H:i:s') }}</p>
                                            </td>
                                            <td class="border-b border-stroke py-4 px-4 text-center dark:border-strokedark" id="t1-{{ data.id }}">
                                                <span class="text-black dark:text-white">{{ data.t1 is not null ? data.t1 ~ ' °C' : '-' }}</span>
                                            </td>
                                            <td class="border-b border-stroke py-4 px-4 text-center dark:border-strokedark" id="rh1-{{ data.id }}">
                                                <span class="text-black dark:text-white">{{ data.rh1 is not null ? data.rh1 ~ ' %' : '-' }}</span>
                                            </td>
                                            <td class="border-b border-stroke py-4 px-4 text-center dark:border-strokedark" id="t2-{{ data.id }}">
                                                <span class="text-black dark:text-white">{{ data.t2 is not null ? data.t2 ~ ' °C' : '-' }}</span>
                                            </td>
                                            <td class="border-b border-stroke py-4 px-4 text-center dark:border-strokedark" id="rh2-{{ data.id }}">
                                                <span class="text-black dark:text-white">{{ data.rh2 is not null ? data.rh2 ~ ' %' : '-' }}</span>
                                            </td>
                                            <td class="border-b border-stroke py-4 px-4 text-center dark:border-strokedark">
                                                <button
                                                    @click="
                                                        editingId = {{ data.id }};
                                                        let t1Val = document.getElementById('t1-' + editingId).textContent.trim().replace(' °C', '');
                                                        let t2Val = document.getElementById('t2-' + editingId).textContent.trim().replace(' °C', '');
                                                        let rh1Val = document.getElementById('rh1-' + editingId).textContent.trim().replace(' %', '');
                                                        let rh2Val = document.getElementById('rh2-' + editingId).textContent.trim().replace(' %', '');
                                                        editData = {
                                                            t1: t1Val === '-' ? '' : t1Val,
                                                            t2: t2Val === '-' ? '' : t2Val,
                                                            rh1: rh1Val === '-' ? '' : rh1Val,
                                                            rh2: rh2Val === '-' ? '' : rh2Val
                                                        };
                                                        modalOpen = true;
                                                    "
                                                    class="inline-flex items-center justify-center rounded bg-primary py-2 px-4 text-white hover:bg-opacity-90"
                                                >
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mr-1">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                                    </svg>
                                                    Uredi
                                                </button>
                                            </td>
                                        </tr>
                                    {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center py-8 text-body dark:text-bodydark">Nema podataka za prikaz</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination -->
                            {% if totalPages > 1 %}
                                <div class="flex items-center justify-between border-t border-stroke px-4 py-4 dark:border-strokedark sm:px-6">
                                    <div class="text-sm text-body dark:text-bodydark">
                                        Stranica <span class="font-medium text-black dark:text-white">{{ currentPage }}</span> od <span class="font-medium text-black dark:text-white">{{ totalPages }}</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        {% if currentPage > 1 %}
                                            <a href="{{ path('app_device_data_modify', { clientId: client.id, id: device.id, entry: entry, page: currentPage - 1, date_from: dateFrom ? dateFrom|date('d.m.Y') : null, date_to: dateTo ? dateTo|date('d.m.Y') : null }) }}"
                                               class="inline-flex items-center justify-center rounded border border-stroke py-2 px-4 text-black hover:bg-gray-2 dark:border-strokedark dark:text-white dark:hover:bg-meta-4">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mr-1">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                                                </svg>
                                                Prethodna
                                            </a>
                                        {% endif %}

                                        <!-- Page Selector Dropdown -->
                                        <div class="relative">
                                            <select
                                                id="pageSelector"
                                                onchange="goToPage(this.value)"
                                                class="appearance-none rounded border border-stroke bg-transparent py-2 pl-4 pr-10 text-black outline-none transition focus:border-primary dark:border-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                                            >
                                                {% for p in 1..totalPages %}
                                                    <option value="{{ p }}" {{ p == currentPage ? 'selected' : '' }}>{{ p }}</option>
                                                {% endfor %}
                                            </select>
                                            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 text-body dark:text-bodydark">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                                </svg>
                                            </span>
                                        </div>

                                        {% if currentPage < totalPages %}
                                            <a href="{{ path('app_device_data_modify', { clientId: client.id, id: device.id, entry: entry, page: currentPage + 1, date_from: dateFrom ? dateFrom|date('d.m.Y') : null, date_to: dateTo ? dateTo|date('d.m.Y') : null }) }}"
                                               class="inline-flex items-center justify-center rounded border border-stroke py-2 px-4 text-black hover:bg-gray-2 dark:border-strokedark dark:text-white dark:hover:bg-meta-4">
                                                Sljedeća
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 ml-1">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                                                </svg>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                                <script>
                                    function goToPage(page) {
                                        const baseUrl = '{{ path('app_device_data_modify', { clientId: client.id, id: device.id, entry: entry }) }}';
                                        const params = new URLSearchParams();
                                        params.set('page', page);
                                        {% if dateFrom %}
                                        params.set('date_from', '{{ dateFrom|date('d.m.Y') }}');
                                        {% endif %}
                                        {% if dateTo %}
                                        params.set('date_to', '{{ dateTo|date('d.m.Y') }}');
                                        {% endif %}
                                        window.location.href = baseUrl + '?' + params.toString();
                                    }
                                </script>
                            {% endif %}
                        </div>
                        <!-- Data Table End -->
                    </div>
                </div>
            </main>
            <!-- ===== Main Content End ===== -->
        </div>
        <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <!-- Edit Modal -->
    <div x-show="modalOpen" x-transition class="fixed left-0 top-0 z-99999 flex h-full min-h-screen w-full items-center justify-center bg-black/90 px-4 py-5">
        <div @click.outside="modalOpen = false" class="w-full max-w-142.5 rounded-lg bg-white px-8 py-12 text-center dark:bg-boxdark md:px-17.5 md:py-15">
            <h3 class="pb-2 text-xl font-bold text-black dark:text-white sm:text-2xl">
                Uredi podatke
            </h3>
            <span class="mx-auto mb-6 inline-block h-1 w-22.5 rounded bg-primary"></span>

            <form @submit.prevent="
                loading = true;
                message = '';
                fetch('/api/device-data/' + editingId + '/update-values', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(editData)
                })
                .then(response => response.json())
                .then(data => {
                    loading = false;
                    if (data.success) {
                        message = data.message;
                        messageType = 'success';
                        document.getElementById('t1-' + editingId).textContent = data.data.t1 ? data.data.t1 + ' °C' : '-';
                        document.getElementById('t2-' + editingId).textContent = data.data.t2 ? data.data.t2 + ' °C' : '-';
                        document.getElementById('rh1-' + editingId).textContent = data.data.rh1 ? data.data.rh1 + ' %' : '-';
                        document.getElementById('rh2-' + editingId).textContent = data.data.rh2 ? data.data.rh2 + ' %' : '-';
                        modalOpen = false;
                    } else {
                        message = data.message;
                        messageType = 'error';
                    }
                })
                .catch(error => {
                    loading = false;
                    message = 'Greška prilikom ažuriranja podataka.';
                    messageType = 'error';
                });
            ">
                <!-- Sensor 1 -->
                <div class="mb-4">
                    <h4 class="text-left font-semibold text-primary mb-3 border-b border-stroke pb-2 dark:border-strokedark">
                        {{ device.entry1['t_name'] ?? 'Senzor 1' }}
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="mb-2.5 block text-left text-black dark:text-white">Temperatura (T1)</label>
                            <input x-model="editData.t1" type="number" step="0.01" min="-99.99" max="99.99"
                                   class="w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                                   placeholder="npr. 25.50" />
                        </div>
                        <div>
                            <label class="mb-2.5 block text-left text-black dark:text-white">Vlažnost (RH1)</label>
                            <input x-model="editData.rh1" type="number" step="0.01" min="-999.99" max="999.99"
                                   class="w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                                   placeholder="npr. 65.00" />
                        </div>
                    </div>
                </div>

                <!-- Sensor 2 -->
                <div class="mb-6">
                    <h4 class="text-left font-semibold text-primary mb-3 border-b border-stroke pb-2 dark:border-strokedark">
                        {{ device.entry2['t_name'] ?? 'Senzor 2' }}
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="mb-2.5 block text-left text-black dark:text-white">Temperatura (T2)</label>
                            <input x-model="editData.t2" type="number" step="0.01" min="-99.99" max="99.99"
                                   class="w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                                   placeholder="npr. 25.50" />
                        </div>
                        <div>
                            <label class="mb-2.5 block text-left text-black dark:text-white">Vlažnost (RH2)</label>
                            <input x-model="editData.rh2" type="number" step="0.01" min="-999.99" max="999.99"
                                   class="w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                                   placeholder="npr. 65.00" />
                        </div>
                    </div>
                </div>
                <div class="-mx-3 flex flex-wrap gap-y-4">
                    <div class="w-full px-3 2xsm:w-1/2">
                        <button @click="modalOpen = false" type="button"
                                class="block w-full rounded border border-stroke bg-gray p-3 text-center font-medium text-black transition hover:border-meta-1 hover:bg-meta-1 hover:text-white dark:border-strokedark dark:bg-meta-4 dark:text-white dark:hover:border-meta-1 dark:hover:bg-meta-1">
                            Odustani
                        </button>
                    </div>
                    <div class="w-full px-3 2xsm:w-1/2">
                        <button type="submit" :disabled="loading"
                                class="block w-full rounded border border-primary bg-primary p-3 text-center font-medium text-white transition hover:bg-opacity-90 disabled:opacity-50">
                            <span x-show="!loading">Spremi</span>
                            <span x-show="loading">Spremanje...</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Edit Modal End -->

    </body>
{% endblock %}
