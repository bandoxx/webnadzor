{% extends 'base.html.twig' %}

{% block javascripts %}
  {{ parent() }}
<script>
  $(document).ready(function() {

    $('.toggle').click(function() { /* BLOCK TOGGLE */
      $(this).toggleClass('show');
      $(this).parent().parent().children('.block_cont').slideToggle(300);
      $(this).parent().toggleClass('show');
      return false;
    });

    $('#clear-confirm').dialog({
      resizable: false,
      autoOpen: false,
      show: {
        effect: 'drop',
        duration: 200
      },
      hide: {
        effect: 'drop',
        duration: 200
      },
      modal: true,
      buttons: {
        'Obriši': function() {
          $.post(page_url + 'login_log/clear_list', {troll:Math.random()}, function(data, s, r) {
            if (r.getResponseHeader('Requires-Auth') == 1) {
              $(location).attr('href', page_url);
              return false;
            }
            if (data == 'ok') {
              $(location).attr('href', page_url + 'login_log');
            }
            else {
              alert('Greška! Molimo pokušajte ponovo');
              console.log('error data: ' + data);
            }
          });
        },
        'Odustani': function() {
          $(this).dialog('close');
        }
      }
    });

    $('#logclear').click(function() { /* CLEAR LOGIN LOG */
      $('#clear-confirm').dialog('open');
      return false;
    });

    $('.tipTop').tipsy({gravity: 's', fade: true}); /* TOOLTIP CLASS */
    $('.tipBot').tipsy({gravity: 'n', fade: true}); /* TOOLTIP CLASS */
    $('.tipLeft').tipsy({gravity: 'e', fade: true}); /* TOOLTIP CLASS */
    $('.tipRight').tipsy({gravity: 'w', fade: true}); /* TOOLTIP CLASS */

    $('.ie #userbar').corner('top 5px'); /* IE BORDER-RADIUS FIX */
    $('.ie .titlebar').corner('top 5px'); /* IE BORDER-RADIUS FIX */
    $('.ie .block_cont').corner('bottom 5px'); /* IE BORDER-RADIUS FIX */
    $('.ie .error, .ie .warning, .ie .success, .ie .information').corner('5px'); /* IE BORDER-RADIUS FIX */

    $('.table').wrap('<div class="table-wrap" />'); /* NORMAL TABLE */
    $('.table tr:even').addClass('even'); /* ODD/EVEN TABLEROW CLASS */
    var otable = $('#login_log_table').dataTable({
      pageLength: 50,
      language: {
        search: "Pretraga",
        loading: "Ucitavanje...",
        lengthMenu: '_MENU_ broj prikaza',
        emptyTable: 'Prazna tablica',
        info: 'Prikaz _START_ od _END_ od ukupno _TOTAL_ rezultata',
        infoEmpty: '',
        infoFiltered: '(filtrirano od _MAX_ rezultata)',
      },
      columnDefs: [
        { className: 'dt-center', targets: '_all' }
      ],
    }); /* DATA TABLES */

  });
</script>
{% endblock %}

{% block navigation %}
    <li><a href="{url}data_logarchive" class="icon_save">Arhiva</a></li>
    <li><a href="{{ path('app_home_overview') }}" class="icon_left">Povratak</a></li>
{% endblock %}

{% block content %}
  <div class="block big"><!-- Block Begin -->
    <div class="titlebar">
      <h3>PREGLED MJERNIH MJESTA</h3>
      <a href="#" class="toggle">&nbsp;</a>
    </div>
    <div class="block_cont" style="padding: 4px;">
      <div id="otable_wrapper" class="dataTables_wrapper" role="grid">
        <div class="data-table-top"></div>
        <div class="clear"></div>
        <div id="otable_processing" class="dataTables_processing" style="visibility: hidden;">
          Obrađujem...
        </div>
        <table id="login_log_table" class="display hover"><!-- Table Wrapper Begin -->
          <thead>
          <tr role="row">
            <th>Datum</th>
            <th>Status</th>
            <th>Korisnicko ime</th>
            <th>IP Adresa</th>
            <th>Preglednik</th>
            <th>OS</th>
          </tr>
          </thead>

          <tbody role="alert" aria-live="polite" aria-relevant="all">
          {% set style = 'odd' %}
          {% for log in logs %}
            <tr class="{{ style }}">
              <td class="">{{ log.serverDate|date('d.m.Y H:i:s') }}</td>
              <td class="">
                {% if log.status == 1%}
                  <span class="green">PR. OK</span>
                {% elseif log.status == 2 %}
                  <span class="red">GR. KOR.</span>
                {% else %}
                  <span class="red">GR. ZAP</span>
                {% endif %}
              </td>
              <td class="">{{ log.username }}</td>
              <td class="">{{ log.ip|long2ip }}</td>
              <td class="">{{ log.browser }}</td>
              <td class="">{{ log.os }}</td>
            </tr>
            {% if style == 'odd' %}
              {% set style = 'even' %}
            {% else %}
              {% set style = 'odd' %}
            {% endif %}
          {% endfor %}
          </tbody>
        </table>
        <div class="clear"></div>
        <div class="data-table-bottom"></div>
        <div class="clear"></div>
      </div><!-- Table Wrapper End -->
    </div>
  </div><!-- Block End -->
{% endblock %}